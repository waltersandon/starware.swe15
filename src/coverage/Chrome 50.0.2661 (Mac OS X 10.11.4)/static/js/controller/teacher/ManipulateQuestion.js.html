<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for static/js/controller/teacher/ManipulateQuestion.js</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../../../../prettify.css" />
    <link rel="stylesheet" href="../../../../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../../../../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../../../../index.html">all files</a> / <a href="index.html">static/js/controller/teacher/</a> ManipulateQuestion.js
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">64.71% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>44/68</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">54.55% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>12/22</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">50% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>14/28</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">64.71% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>44/68</span>
      </div>
    </div>
  </div>
  <div class='status-line medium'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124</td><td class="line-coverage quiet"><span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">8×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">$(function () {
    angular.module('app.App').controller('controller.teacher.ManipulateQuestion', ['util.Editor', 'model.data.Error', '$location', 'util.QML', 'model.data.Question', 'model.service.QuestionService', '$rootScope', '$scope', 'model.data.Tag', 'model.service.TagService', function (Editor, Error, $location, QML, Question, QuestionService, $rootScope, $scope, Tag, TagService) {
            $scope.error = new Error();
            $scope.submit = function () {
                <span class="missing-if-branch" title="else path not taken" >E</span>if (QML.parse($scope.editor.value()).status) {
                    $scope.question.body = $scope.editor.value();
                    $scope.question.tags = [];
&nbsp;
                    async.each($scope.tagsInput.split(','), function (tagInput, cll) {
                        <span class="missing-if-branch" title="else path not taken" >E</span>if (tagInput.trim() !== '') {
                            var find = false;
                            $scope.tags.forEach(function (item) {
                                if (item.name === tagInput.trim()) {
                                    <span class="missing-if-branch" title="else path not taken" >E</span>if ($scope.question.tags.indexOf(item.id) &lt; 0) {
                                        $scope.question.tags.push(item.id);
                                        find = true;
                                    }
                                }
                            });
                            <span class="missing-if-branch" title="if path not taken" >I</span>if (!find) {
<span class="cstat-no" title="statement not covered" >                                TagService.new(new Tag('', '', tagInput.trim()), <span class="fstat-no" title="function not covered" >function (res) {</span></span>
<span class="cstat-no" title="statement not covered" >                                    $scope.question.tags.push(res._id);</span>
<span class="cstat-no" title="statement not covered" >                                    cll();</span>
                                }, <span class="fstat-no" title="function not covered" >function (res) {</span>
<span class="cstat-no" title="statement not covered" >                                    cll();</span>
                                });
                            } else {
                                cll();
                            }
                        } else {
<span class="cstat-no" title="statement not covered" >                            cll();</span>
                        }
                    }, function (err, res) {
                        if ($scope.edit) {
                            QuestionService.modify($scope.question, <span class="fstat-no" title="function not covered" >function () {</span>
<span class="cstat-no" title="statement not covered" >                                $location.path('teacher/questions');</span>
                            }, <span class="fstat-no" title="function not covered" >function (res) {</span>
&nbsp;
                            });
                        } else {
                            QuestionService.new($scope.question, <span class="fstat-no" title="function not covered" >function () {</span>
<span class="cstat-no" title="statement not covered" >                                $location.path('teacher/questions');</span>
                            }, <span class="fstat-no" title="function not covered" >function (res) {</span>
&nbsp;
                            });
                        }
                    });
                } else {
<span class="cstat-no" title="statement not covered" >                    $scope.error = new Error(QML.parse($scope.editor.value()).message, 'errorQML', true, 'alert-danger');</span>
                }
            };
            function buildEditor() {
                $scope.editor = Editor.editor();
                $scope.editor.value($scope.question.body);
            }
            function ManipulateQuestion() {
                if ($scope.urlPath()[3] === 'new') {
                    $scope.question = new Question();
                    $scope.edit = false;
                    buildEditor();
                } else <span class="missing-if-branch" title="else path not taken" >E</span>if ($scope.urlPath()[3] === 'modify') {
                    QuestionService.getByID($scope.urlPath()[4], function (question) {
                        <span class="missing-if-branch" title="else path not taken" >E</span>if (question.author === $rootScope.me.id) {
                            $scope.question = question;
                            $scope.tagsInput = '';
                            async.each($scope.question.tags, function (tag, cll) {
                                TagService.getByID(tag, function (tagComplete) {
                                    $scope.tagsInput += tagComplete.name + ', ';
                                    cll();
                                }, <span class="fstat-no" title="function not covered" >function (res) {</span>
<span class="cstat-no" title="statement not covered" >                                    cll();</span>
                                });
                            }, function (err, res) {
                                $scope.edit = true;
                                buildEditor();
                            });
                        } else {
<span class="cstat-no" title="statement not covered" >                            $location.path('teacher/questions');</span>
                        }
                    }, function (res) {
                        $location.path('teacher/questions');
                    });
                }
&nbsp;
                TagService.get('', function (tags) {
                    $scope.tags = tags;
&nbsp;
                    $('#tags').bind('keydown', <span class="fstat-no" title="function not covered" >function (event) {</span>
<span class="cstat-no" title="statement not covered" >                        if (event.keyCode === $.ui.keyCode.TAB &amp;&amp; $(this).autocomplete('instance').menu.active) {</span>
<span class="cstat-no" title="statement not covered" >                            event.preventDefault();</span>
                        }
                    }).autocomplete({
                        minLength: 0,
                        source: <span class="fstat-no" title="function not covered" >function (request, response) {</span>
<span class="cstat-no" title="statement not covered" >                            response($.ui.autocomplete.filter(<span class="fstat-no" title="function not covered" >function () {</span></span>
<span class="cstat-no" title="statement not covered" >                                var ret = [];</span>
<span class="cstat-no" title="statement not covered" >                                $scope.tags.forEach(<span class="fstat-no" title="function not covered" >function (item) {</span></span>
<span class="cstat-no" title="statement not covered" >                                    ret.push(item.name);</span>
                                });
<span class="cstat-no" title="statement not covered" >                                return ret;</span>
                            }(), request.term.split(/,\s*/).pop()));
                        },
                        focus: <span class="fstat-no" title="function not covered" >function () {</span>
<span class="cstat-no" title="statement not covered" >                            return false;</span>
                        },
                        select: <span class="fstat-no" title="function not covered" >function (event, ui) {</span>
<span class="cstat-no" title="statement not covered" >                            var terms = this.value.split(/,\s*/);</span>
<span class="cstat-no" title="statement not covered" >                            terms.pop();</span>
<span class="cstat-no" title="statement not covered" >                            terms.push(ui.item.value);</span>
<span class="cstat-no" title="statement not covered" >                            terms.push('');</span>
<span class="cstat-no" title="statement not covered" >                            this.value = terms.join(', ');</span>
<span class="cstat-no" title="statement not covered" >                            return false;</span>
                        }
                    });
                }, <span class="fstat-no" title="function not covered" >function (res) {</span>
&nbsp;
                });
            }
&nbsp;
            ManipulateQuestion();
        }]);
});
&nbsp;
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Tue May 10 2016 12:07:59 GMT+0200 (CEST)
</div>
</div>
<script src="../../../../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../../../../sorter.js"></script>
</body>
</html>
